import { add } from 'date-fns';
import { v4 as uuid } from 'uuid';
import faker from 'faker';
// const uuids = [uuid()];

const assignees = [...Array(200).keys()].map(() => ({
  ...faker.helpers.contextualCard(),
  id: faker.random.uuid(),
}));

const activityFakes = [...Array(200).keys()].map(() => ({
  id: faker.random.uuid(),
  created: add(new Date(), {
    days: faker.random.number({
      min: -10,
      max: 0,
    }),
  }).getTime(),
  updated: new Date().getTime(),
  time: faker.random.number({
    min: 0.25,
    max: 3,
    precision: 0.25,
  }),
  timeUnit: 'hour',
  content: faker.company.catchPhrase() + faker.random.words(20),
  user: faker.random.arrayElement(assignees),
  replies: [],
}));

const getFakeActivityIds = num => {
  if (num > 0) {
    return [faker.random.arrayElement(activityFakes).id, ...getFakeActivityIds(num - 1)];
  }
  return [];
};

const estimatorProjects = [
  {
    id: 589,
    name: 'ABM Transformation',
    code: null,
    created_at: '2018-10-19T17:20:12.349Z',
    updated_at: '2018-10-19T17:20:12.714Z',
    created_by: 7,
    version_id: 852,
    reference: null,
    scope_url: null,
    mavenlink_workspace_name: null,
    workspace_id: null,
  },
];
const estimatorTasks = [
  {
    id: 14567,
    name: 'Enable a Direct Mail strategy',
    owner: '',
    high: 45,
    low: 20,
    estimate_task_id: 14534,
    created_at: '2018-10-19T17:41:01.900Z',
    updated_at: '2018-10-19T17:49:12.655Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14546,
    name: 'Technology audit (to develop Data Landscape)',
    owner: '',
    high: 48,
    low: 24,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:30:10.417Z',
    updated_at: '2018-10-19T17:46:12.641Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14537,
    name: 'Stand Up Engagio Platform',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:26:14.688Z',
    updated_at: '2018-10-19T17:41:38.697Z',
    created_by: 7,
    order: 7,
    notes: null,
    version_id: 852,
  },
  {
    id: 14538,
    name: 'Enable Go To Marketing and Revenue Operations team on ABM',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:26:42.054Z',
    updated_at: '2018-10-19T17:41:38.887Z',
    created_by: 7,
    order: 8,
    notes: null,
    version_id: 852,
  },
  {
    id: 14536,
    name: 'Measuring ABM',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:25:15.138Z',
    updated_at: '2018-10-19T17:41:39.079Z',
    created_by: 7,
    order: 9,
    notes: null,
    version_id: 852,
  },
  {
    id: 14535,
    name: 'Orchestrate  Account Plays',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:24:36.785Z',
    updated_at: '2018-10-19T17:41:39.256Z',
    created_by: 7,
    order: 6,
    notes: null,
    version_id: 852,
  },
  {
    id: 14545,
    name: 'Data Strategy & Tooling',
    owner: '',
    high: 40,
    low: 16,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:29:53.334Z',
    updated_at: '2018-10-19T17:46:19.177Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14544,
    name: 'Data Exploration ',
    owner: '',
    high: 24,
    low: 8,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:29:46.684Z',
    updated_at: '2018-10-19T17:46:26.718Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14549,
    name: 'Clean Up of Salesforce Data & Structure',
    owner: '',
    high: 80,
    low: 40,
    estimate_task_id: 14550,
    created_at: '2018-10-19T17:32:20.358Z',
    updated_at: '2018-10-19T17:45:36.593Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14540,
    name: 'Data - Enabling Firmographics Data / Strategy',
    owner: '',
    high: 40,
    low: 16,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:28:10.542Z',
    updated_at: '2018-10-19T17:46:37.935Z',
    created_by: 7,
    order: 4,
    notes: null,
    version_id: 852,
  },
  {
    id: 14543,
    name: 'Data - Enabling Engagement Data / Strategy',
    owner: '',
    high: 55,
    low: 24,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:29:21.838Z',
    updated_at: '2018-10-19T17:47:00.743Z',
    created_by: 7,
    order: 7,
    notes: null,
    version_id: 852,
  },
  {
    id: 14551,
    name: 'Lead To Account Matching Process',
    owner: '',
    high: 16,
    low: 4,
    estimate_task_id: 14531,
    created_at: '2018-10-19T17:33:32.282Z',
    updated_at: '2018-10-19T17:47:20.697Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14554,
    name: 'Enable Market Info For Account',
    owner: '',
    high: 20,
    low: 12,
    estimate_task_id: 14532,
    created_at: '2018-10-19T17:35:48.626Z',
    updated_at: '2018-10-19T17:47:47.503Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14530,
    name: 'Select Accounts',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:21:01.837Z',
    updated_at: '2018-10-19T17:32:46.529Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14547,
    name: 'Scoring of accounts against Fit & Ability to sell (level 4)',
    owner: '',
    high: 30,
    low: 16,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:30:42.504Z',
    updated_at: '2018-10-19T17:47:08.597Z',
    created_by: 7,
    order: 8,
    notes: null,
    version_id: 852,
  },
  {
    id: 14559,
    name: 'Develop Insight Process / Account strategy documentation',
    owner: '',
    high: 40,
    low: 16,
    estimate_task_id: 14532,
    created_at: '2018-10-19T17:38:28.366Z',
    updated_at: '2018-10-19T17:48:26.555Z',
    created_by: 7,
    order: 5,
    notes: null,
    version_id: 852,
  },
  {
    id: 14532,
    name: 'Account Insights',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:21:35.343Z',
    updated_at: '2018-10-19T17:33:17.178Z',
    created_by: 7,
    order: 3,
    notes: null,
    version_id: 852,
  },
  {
    id: 14533,
    name: 'Account Relevant Message & Content',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:23:05.018Z',
    updated_at: '2018-10-19T17:33:17.323Z',
    created_by: 7,
    order: 4,
    notes: null,
    version_id: 852,
  },
  {
    id: 14541,
    name: 'Data - Enabling Technology Data / Strategy',
    owner: '',
    high: 12,
    low: 4,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:28:14.955Z',
    updated_at: '2018-10-19T17:46:44.725Z',
    created_by: 7,
    order: 5,
    notes: null,
    version_id: 852,
  },
  {
    id: 14539,
    name: 'Tier Development & Agreement',
    owner: '',
    high: 16,
    low: 8,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:27:32.824Z',
    updated_at: '2018-10-19T17:46:31.359Z',
    created_by: 7,
    order: 3,
    notes: null,
    version_id: 852,
  },
  {
    id: 14534,
    name: 'Deliver account-specific interactions',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:23:20.771Z',
    updated_at: '2018-10-19T17:33:17.458Z',
    created_by: 7,
    order: 5,
    notes: null,
    version_id: 852,
  },
  {
    id: 14552,
    name: 'Personification of roles and contacts',
    owner: '',
    high: 80,
    low: 40,
    estimate_task_id: 14531,
    created_at: '2018-10-19T17:33:45.399Z',
    updated_at: '2018-10-19T17:47:27.548Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14557,
    name: 'Enable realtionship understanding at the account',
    owner: '',
    high: 40,
    low: 20,
    estimate_task_id: 14532,
    created_at: '2018-10-19T17:36:38.614Z',
    updated_at: '2018-10-19T17:48:07.522Z',
    created_by: 7,
    order: 3,
    notes: null,
    version_id: 852,
  },
  {
    id: 14548,
    name: 'Account Load Process ',
    owner: '',
    high: 8,
    low: 4,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:32:08.522Z',
    updated_at: '2018-10-19T17:47:13.499Z',
    created_by: 7,
    order: 9,
    notes: null,
    version_id: 852,
  },
  {
    id: 14542,
    name: 'Data-  Enabling Intent Data / Strategy',
    owner: '',
    high: 24,
    low: 16,
    estimate_task_id: 14530,
    created_at: '2018-10-19T17:28:49.726Z',
    updated_at: '2018-10-19T17:46:54.334Z',
    created_by: 7,
    order: 6,
    notes: null,
    version_id: 852,
  },
  {
    id: 14531,
    name: 'Contact Mapping & Discovery',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:21:19.982Z',
    updated_at: '2018-10-19T17:33:18.601Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14555,
    name: 'Enable Knowing Inside the company',
    owner: '',
    high: 45,
    low: 25,
    estimate_task_id: 14532,
    created_at: '2018-10-19T17:36:06.220Z',
    updated_at: '2018-10-19T17:47:53.259Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14550,
    name: 'Clean Up of IT Tooling',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:32:29.524Z',
    updated_at: '2018-10-19T17:32:42.399Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14553,
    name: 'Enable a standard contact mix for ABM',
    owner: '',
    high: 35,
    low: 20,
    estimate_task_id: 14531,
    created_at: '2018-10-19T17:34:06.405Z',
    updated_at: '2018-10-19T17:47:38.262Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14562,
    name: 'Adapt Existing Content',
    owner: '',
    high: 80,
    low: 40,
    estimate_task_id: 14533,
    created_at: '2018-10-19T17:39:41.022Z',
    updated_at: '2018-10-19T17:48:42.589Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14565,
    name: 'Enable Online Advertising ',
    owner: '',
    high: 40,
    low: 25,
    estimate_task_id: 14534,
    created_at: '2018-10-19T17:40:32.422Z',
    updated_at: '2018-10-19T17:49:02.200Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14560,
    name: "Develop Go Nimbly's Content Personalization Spectrum",
    owner: '',
    high: 30,
    low: 12,
    estimate_task_id: 14533,
    created_at: '2018-10-19T17:39:00.171Z',
    updated_at: '2018-10-19T17:48:33.648Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14556,
    name: 'Enable Contact mapping to Target Persona',
    owner: '',
    high: 20,
    low: 12,
    estimate_task_id: 14532,
    created_at: '2018-10-19T17:36:21.578Z',
    updated_at: '2018-10-19T17:48:00.935Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14558,
    name: 'Enable connection to connection mapping between Go Nimbly & Account',
    owner: '',
    high: 25,
    low: 12,
    estimate_task_id: 14532,
    created_at: '2018-10-19T17:37:34.544Z',
    updated_at: '2018-10-19T17:48:18.222Z',
    created_by: 7,
    order: 4,
    notes: null,
    version_id: 852,
  },
  {
    id: 14563,
    name: 'Identify Content Gaps',
    owner: '',
    high: 20,
    low: 10,
    estimate_task_id: 14533,
    created_at: '2018-10-19T17:39:46.851Z',
    updated_at: '2018-10-19T17:48:45.842Z',
    created_by: 7,
    order: 3,
    notes: null,
    version_id: 852,
  },
  {
    id: 14561,
    name: 'Conduct a content audit ',
    owner: '',
    high: 40,
    low: 16,
    estimate_task_id: 14533,
    created_at: '2018-10-19T17:39:33.653Z',
    updated_at: '2018-10-19T17:48:38.072Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14564,
    name: 'Build Content Roadmap based on Gaps',
    owner: '',
    high: 30,
    low: 8,
    estimate_task_id: 14533,
    created_at: '2018-10-19T17:40:04.306Z',
    updated_at: '2018-10-19T17:48:55.062Z',
    created_by: 7,
    order: 4,
    notes: null,
    version_id: 852,
  },
  {
    id: 14577,
    name: 'Develop another project plan for training consultants on the process',
    owner: '',
    high: 30,
    low: 16,
    estimate_task_id: 14538,
    created_at: '2018-10-19T17:44:36.125Z',
    updated_at: '2018-10-19T17:50:08.709Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14578,
    name: 'Enable Coverage Metrics',
    owner: '',
    high: 25,
    low: 16,
    estimate_task_id: 14536,
    created_at: '2018-10-19T17:44:45.096Z',
    updated_at: '2018-10-19T17:50:17.334Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14566,
    name: 'Enable ABM in Drift to personalize our website',
    owner: '',
    high: 16,
    low: 8,
    estimate_task_id: 14534,
    created_at: '2018-10-19T17:40:43.853Z',
    updated_at: '2018-10-19T17:49:08.427Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14579,
    name: 'Enable Awareness Metrics',
    owner: '',
    high: 25,
    low: 16,
    estimate_task_id: 14536,
    created_at: '2018-10-19T17:44:55.386Z',
    updated_at: '2018-10-19T17:50:20.749Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14568,
    name: 'Enable a stronger Email strategy',
    owner: '',
    high: 25,
    low: 16,
    estimate_task_id: 14534,
    created_at: '2018-10-19T17:41:09.745Z',
    updated_at: '2018-10-19T17:49:17.139Z',
    created_by: 7,
    order: 3,
    notes: null,
    version_id: 852,
  },
  {
    id: 14569,
    name: 'Select and modify 7 plays to run on trigger events',
    owner: '',
    high: 40,
    low: 25,
    estimate_task_id: 14535,
    created_at: '2018-10-19T17:41:48.668Z',
    updated_at: '2018-10-19T17:49:23.307Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14570,
    name: 'Develop Account Plans for Tier 1 ',
    owner: '',
    high: 60,
    low: 40,
    estimate_task_id: 14535,
    created_at: '2018-10-19T17:42:08.796Z',
    updated_at: '2018-10-19T17:49:27.882Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14580,
    name: 'Enable Engagement Metrics',
    owner: '',
    high: 25,
    low: 16,
    estimate_task_id: 14536,
    created_at: '2018-10-19T17:45:00.319Z',
    updated_at: '2018-10-19T17:50:23.766Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14571,
    name: 'Develop Segment Plans for Tier 2',
    owner: '',
    high: 40,
    low: 20,
    estimate_task_id: 14535,
    created_at: '2018-10-19T17:42:24.611Z',
    updated_at: '2018-10-19T17:49:31.193Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14572,
    name: ' Develop Solution Plans for Tier 3',
    owner: '',
    high: 40,
    low: 20,
    estimate_task_id: 14535,
    created_at: '2018-10-19T17:43:34.501Z',
    updated_at: '2018-10-19T17:49:34.492Z',
    created_by: 7,
    order: 3,
    notes: null,
    version_id: 852,
  },
  {
    id: 14581,
    name: 'Enable Reach Metrics',
    owner: '',
    high: 25,
    low: 16,
    estimate_task_id: 14536,
    created_at: '2018-10-19T17:45:04.231Z',
    updated_at: '2018-10-19T17:50:25.447Z',
    created_by: 7,
    order: 3,
    notes: null,
    version_id: 852,
  },
  {
    id: 14573,
    name: "Work through Engagio's implementation process",
    owner: '',
    high: 50,
    low: 30,
    estimate_task_id: 14537,
    created_at: '2018-10-19T17:43:50.293Z',
    updated_at: '2018-10-19T17:49:43.321Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14574,
    name: 'Enable the technology',
    owner: '',
    high: 35,
    low: 15,
    estimate_task_id: 14537,
    created_at: '2018-10-19T17:43:53.583Z',
    updated_at: '2018-10-19T17:49:49.008Z',
    created_by: 7,
    order: 1,
    notes: null,
    version_id: 852,
  },
  {
    id: 14582,
    name: 'Enable Influence Metrics',
    owner: '',
    high: 25,
    low: 16,
    estimate_task_id: 14536,
    created_at: '2018-10-19T17:45:27.096Z',
    updated_at: '2018-10-19T17:50:27.204Z',
    created_by: 7,
    order: 4,
    notes: null,
    version_id: 852,
  },
  {
    id: 14583,
    name: 'Meetings',
    owner: null,
    high: null,
    low: null,
    estimate_task_id: null,
    created_at: '2018-10-19T17:50:52.980Z',
    updated_at: '2018-10-19T17:50:52.982Z',
    created_by: 7,
    order: 10,
    notes: null,
    version_id: 852,
  },
  {
    id: 14575,
    name: 'Get trained on the technology',
    owner: '',
    high: 20,
    low: 15,
    estimate_task_id: 14537,
    created_at: '2018-10-19T17:44:01.682Z',
    updated_at: '2018-10-19T17:49:56.492Z',
    created_by: 7,
    order: 2,
    notes: null,
    version_id: 852,
  },
  {
    id: 14584,
    name: 'Weekly ABM Sync (Implementation Only)',
    owner: '',
    high: 60,
    low: 48,
    estimate_task_id: 14583,
    created_at: '2018-10-19T17:51:24.576Z',
    updated_at: '2018-10-19T17:51:24.577Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
  {
    id: 14576,
    name: 'Build Training for Go to Market team and Rev Ops team internal',
    owner: '',
    high: 30,
    low: 16,
    estimate_task_id: 14538,
    created_at: '2018-10-19T17:44:20.556Z',
    updated_at: '2018-10-19T17:50:04.225Z',
    created_by: 7,
    order: 0,
    notes: null,
    version_id: 852,
  },
];

const defaultData = {
  accounts: [
    {
      id: 'act1',
      name: 'Better Place Forests',
      workstreams: ['workstream-1', ...estimatorProjects.map(p => `${p.id}`)],
    },
  ],
  workstreams: [
    {
      id: 'workstream-1',
      name: 'Integrate FullCircle',
      startDate: add(new Date(), {
        days: -10,
      }).getTime(),
      endDate: add(new Date(), {
        days: 10,
      }).getTime(),
      tasks: ['task-123'],
    },
    ...estimatorProjects.map(project => {
      return {
        name: project.name,
        created: new Date(project.created_at).getTime(),
        updated: new Date(project.updated_at).getTime(),
        startDate: add(new Date(), {
          days: -10,
        }).getTime(),
        endDate: add(new Date(), {
          days: 10,
        }).getTime(),
        id: `${project.id}`,
        tasks: estimatorTasks.map(task => `${task.id}`),
      };
    }),
  ],
  tasks: [
    {
      id: 'task-123',
      name: 'Create auth scope for full circle api',
      desc: '',
      estimateHigh: 3,
      estimateLow: 3,
      estUnit: 'hour',
      created: new Date().getTime(),
      updated: new Date().getTime(),
      status: 'in progress',
      activity: [],
    },
    ...estimatorTasks.map(task => {
      return {
        id: `${task.id}`,
        name: task.name,
        estimateHigh: task.high || 0,
        estimateLow: task.low || 0,
        estUnit: 'hour',
        created: new Date(task.created_at).getTime(),
        updated: new Date(task.updated_at).getTime(),
        status: 'not started',
        desc: task.notes || faker.lorem.paragraph(),
        activity: getFakeActivityIds(
          faker.random.number({
            min: 0,
            max: 10,
          })
        ),
      };
    }),
  ],
  activity: [...activityFakes],
};

const rollup = field => (sum, obj) => {
  return (obj[field] || 0) + sum;
};

const getWorkstreamMap = () => {
  return defaultData.workstreams.reduce((map, ws) => ({
    ...map,
    [ws.id]: ws,
  }));
};

const getTasksMap = () => {
  return defaultData.tasks.reduce((map, task) => ({
    ...map,
    [task.id]: task,
  }));
};

const getActivityMap = () => {
  return defaultData.activity.reduce((map, activity) => ({
    ...map,
    [activity.id]: activity,
  }));
};

export const fetchAccounts = () => {
  return defaultData.accounts;
};

export const fetchAccount = id => {
  return defaultData.accounts.find(act => act.id === id);
};

export const addAccount = act => {
  const account = {
    ...act,
    workstreams: [],
    id: uuid(),
  };
  defaultData.accounts.push(account);
  return account;
};

export const fetchAccountWorkstreams = actId => {
  const account = fetchAccount(actId);
  if (!account) {
    return [];
  }
  const workstreamIds = account.workstreams;
  return defaultData.workstreams.filter(ws => workstreamIds.includes(ws.id));
};

export const fetchWorkstream = id => {
  return defaultData.workstreams.find(ws => ws.id === id);
};

export const fetchWorkstreamActivity = workstreamId => {
  const tasks = fetchWorkstreamTasks(workstreamId);
  const activityMap = getActivityMap();
  const workstreamActivityMap = {};
  tasks
    .reduce((allActivity, task) => [...allActivity, ...task.activity.map(id => activityMap[id]).filter(Boolean)], [])
    .forEach(activity => {
      workstreamActivityMap[activity.id] = activity;
    });
  console.log(workstreamActivityMap);
  return Object.values(workstreamActivityMap);
};

export const fetchWorkstreamTasks = workstreamId => {
  const workstream = fetchWorkstream(workstreamId);
  const tasksMap = getTasksMap();

  if (!workstream) {
    return [];
  }
  const taskIds = workstream.tasks;
  return taskIds.map(id => tasksMap[id]).filter(Boolean);
};

export const addWorkstream = ws => {
  const workstream = {
    ...ws,
    id: uuid(),
    tasks: [],
  };
  defaultData.workstreams.push(workstream);
  return workstream;
};

export const addWorkstreamToAccount = (ws, accountId) => {
  const account = fetchAccount(accountId);
  if (!account) {
    return;
  }
  const workstream = addWorkstream(ws);
  account.workstreams.push(workstream.id);
};

export const fetchWorkstreamMetaData = wsId => {
  // const ws = fetchWorkstream(wsId);
  const tasks = fetchWorkstreamTasks(wsId);
  const completedTasks = tasks.filter(t => t.status === 'done');
  const rollupEstTotal = tasks.reduce(rollup('estimateHigh'), 0);
  const adhocTasks = tasks.filter(t => t.type === 'adhoc');
  return {
    rollupEstTotal,
    totalTasks: tasks.length,
    completedTasks: completedTasks.length,
    adhocTasks: adhocTasks.length,
    rollupAdhocTimeWorked: 12,
    rollupTimeWorked: 32,
  };
};
